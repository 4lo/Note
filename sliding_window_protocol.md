# 选择重传协议

如果错五很少发生，则回退n协议可以供做得很好；

但是，如果线路质量很差，那么重传的帧要浪费大量带宽。

另一种错误处理的策略是 

### **选择重传协议**：

允许对方接受并缓存坏帧或者丢失真后面的所有帧。

接收方为窗口的每个序号保留一个缓冲区,每个缓冲区有一个标志位,看缓冲区是空的还是满的

*缓冲区大小 = 窗口大小 = 计时器数*

![1545822578012](assets/1545822578012.png)

发送方窗口:[0..max]

接收方窗口:[fixed..fixed] 固定不变. 

#### 非顺序接收引发的问题:

当接收方向前移动他的窗口后,新的有效序号的范围与老的序号范围有重叠.因此,后续的一批帧可能是重复的帧(如果所有的确认都丢失了),也可能使新的帧(如果所有的确认都接受到了). **但是接收方无法区分这两种情形**

#### 解决方法:

窗口的最大尺寸应该不超过序号空间的一半

RWS = (MAX_SEQ+1)/2

来确保接收方向前移动窗口之后,新窗口与老窗口的序号没有重叠.







